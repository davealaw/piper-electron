<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Piper TTS GUI</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    label {
      font-weight: bold;
    }
    input, textarea, select {
      width: 100%;
      margin: 10px 0;
      padding: 6px;
      font-size: 1em;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      margin-top: 10px;
    }
    #status {
      margin-top: 10px;
      color: #444;
    }
    .inline-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .inline-group input[type="text"] {
      flex-grow: 1;
    }
  </style>
</head>
<body>
  <h2>Piper TTS</h2>

  <label for="modelSelect">Choose Voice Model:</label>
  <select id="modelSelect">
    <option disabled selected>Loading models...</option>
  </select>

  <label for="ttsText">Text to Speak:</label>
  <textarea id="ttsText" rows="5" placeholder="Enter text here..."></textarea>

  <label for="outputPath">Output File (optional):</label>
  <div class="inline-group">
    <input id="outputPath" type="text" readonly placeholder="out.wav (default)" />
    <button onclick="chooseOutput()">Browse...</button>
  </div>

  <button onclick="speakText()">Speak</button>

  <p id="status"></p>

  <script>
    let outputFilePath = null;

    async function populateVoices() {
      const voices = await window.piperAPI.getVoiceModels();
      const select = document.getElementById('modelSelect');
      if (!voices.length) {
        select.innerHTML = `<option disabled selected>No models found</option>`;
        return;
      }

      select.innerHTML = voices.map(path =>
        `<option value="${path}">${path.split('/').pop()}</option>`
      ).join('');
    }

    async function chooseOutput() {
      const selected = await window.piperAPI.chooseOutputFile();
      if (selected) {
        outputFilePath = selected;
        document.getElementById('outputPath').value = outputFilePath;
      }
    }

    async function speakText() {
      const text = document.getElementById('ttsText').value;
      const modelPath = document.getElementById('modelSelect').value;
      const status = document.getElementById('status');
      status.textContent = 'Processing...';

      try {
        await window.piperAPI.speak(text, modelPath, outputFilePath);
        status.textContent = 'Done!';
      } catch (err) {
        status.textContent = 'Error: ' + err;
      }
    }

    window.onload = populateVoices;
  </script>
</body>
</html>
